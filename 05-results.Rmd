# Results

## Trends in glucose levels

To understand how the glucose measurement values vary before and after each meal, we can look at the boxplot of glucose levels grouped by different categories, in this data set there is a indicator for whether the measurement value is before or after the meal, for the healthy group data set.

```{r}
library(tidyverse)
library(ggplot2)

healthy_df <- read.csv('data/healthy_patients_glucose.csv', na.strings = "")

df <- healthy_df %>%
  mutate(type = case_when(
    type == 'BB' ~ 'Before Breakfast',
    type == 'AB' ~ 'After Breakfast',
    type == 'BL' ~ 'Before Lunch',
    type == 'AL' ~ 'After Lunch',
    type == 'BD' ~ 'Before Dinner',
    type == 'AD' ~ 'After Dinner'
  ))
df <- na.omit(df)
df$type <- factor(df$type, levels = c("Before Breakfast", "After Breakfast",
                                      "Before Lunch", "After Lunch",
                                      "Before Dinner", "After Dinner"))
df$glucose <- as.numeric(df$glucose)
ggplot(df, aes(x = type, y = glucose)) +
  geom_boxplot() +
  xlab("measurement category") +
  ylab("glucose level [mmol/l]") +
  ggtitle("Glucose measurements for healthy group by categories") +
  coord_flip() +
  theme_grey(13) +
  theme(plot.title = element_text(hjust = 0.5))
```

We can see that on an average glucose levels tend to be higher in the measurements which are taken 2 hours after each meal, compared to the corresponding values before eating.

As we have glucose measurement every 5 minutes for the diabetes patients data set, let us now look into variation in glucose levels for each of the diabetes patient during the data collection period:

```{r}
diabetes_df <- read.csv('data/diabetes_patients_glucose.csv', na.strings = "")
diabetes_df$patient <- as.factor(diabetes_df$patient)
diabetes_df$glucose <- as.numeric(diabetes_df$glucose)
ggplot(diabetes_df, aes(x = patient, y = glucose)) +
  geom_boxplot() +
  xlab("patient") +
  ylab("glucose level [mmol/l]") +
  ggtitle("Glucose measurements for each diabetes patient") +
  theme_grey(13) +
  theme(plot.title = element_text(hjust = 0.5))
```

Looking at these distributions of glucose levels for healthy group and diabetes patients, it is usual that glucose levels for people with diabetes tend to be higher than healthy group, due to the fact that in case of type 1 diabetes, pancreas produce little or no insulin and as a result glucose builds up in the bloodstream as there is scarcity of insulin to let glucose into the cells. 

We see that patient number 9 tend to have less glucose levels compared to others, so we can infer that patient 9 is more prone to have glucose levels that can trigger hypoglycemia (blood sugar levels drop) events causing danger, as 3.9 mmol/l is the commonly used lower threshold for normal glucose.

## Does changes in glucose level correlate with changes in ECG signals?

Now let us look at glucose level variation with time for patient 9 on a specific day and then compare with other sensor data available, in order to detect patterns or correlations.

```{r}
library(lubridate)

p9 <- diabetes_df %>% filter(patient == 9)
p9$datetime = paste(p9$date, p9$time)
# retaining only the data where we have continuous measurements to detect patterns
p9_2 <- p9 %>% filter(date == '2014-10-03')
# excluding manual measurements
p9_2 <- p9_2 %>% filter(type != 'manual')
p9_2 <- p9_2 %>%
  mutate(datetime = ymd_hms(datetime),
         date = format(datetime, "%b %d")) 
# time series plot with horizontal line indicating hypoglycemia threshold
g <- ggplot(p9_2, aes(datetime, glucose)) + geom_point()
g + geom_line(color = "grey50") +
  geom_hline(yintercept = 3.9, linetype = "dashed", color = "red") +
  ggtitle("Glucose level with time for patient 9") +
  labs(x = "time", y = "glucose level [mmol/l]") +
  theme_grey(13) +
  theme(plot.title = element_text(hjust = 0.5))
```

We see hypoglycemic events from the above figure i.e when glucose level is less than 3.9 mmol/l
